## Introduction 

Please refer to https://github.com/w3f/Open-Grants-Program/pull/212 for descriptions. 

## A Note for Web3 Foundation OpenGrantProgram Reviewers
For Milestone 0 Evaluation: the code base delivers all functionalities of Milestone0 as of commit 196f61f3adbb98828315669537433fbfa3e838a8

We are continiously working on the code, while being reviewed. The code base is under heavy development. hopefully we won't accidentally introduce breaking changes, but if we do, please go to commit 196f61f3adbb98828315669537433fbfa3e838a8. 

Thanks!

## How to Run Tests

This guide is tested on macOS only. Feel free to comment if you would like me to help setting it up on other platforms as well. 

#### Install Node.js

please reference to [Node.js Website](https://nodejs.org/en/download/) 

- We recommend you to install [yarn](https://classic.yarnpkg.com/en/docs/install/#mac-stable) as an alternative to `npm` . Simple run `npm install --global yarn` 

- The repo is tested with nodejs version `14.6.0` , to check on your nodejs version `node -v` , to switch version of node, I recommend using [n](https://github.com/tj/n) by TJ. 

    

#### Setup the Substrate smart contract development environment

A good general guide to setup the environment for Substrate environment can be founded [here](https://substrate.dev/docs/en/knowledgebase/getting-started/). 



1. Install Rust for help: refer to [Rust Website](https://www.rust-lang.org/tools/install)

    ```bash
    curl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs | sh
    source $HOME/.cargo/env
    ```

    Check your installed version
    ```bash
    rustc --version
    cargo --version
    ```
    This guides is tested with `rustc 1.50.0 (cb75ad5db 2021-02-10)` and `cargo 1.50.0 (f04e7fab7 2021-02-04)`

2. Install [Binaryen](https://github.com/WebAssembly/binaryen). You can simply install with [Homebrew](https://brew.sh/) on macOS

    ```bash
    brew install binaryen
    ```

    To install `Homebrew` use

    ```bash
    /bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"
    ```

3. Install [cargo-contract](https://github.com/paritytech/cargo-contract) 

    ```bash
    cargo install --force cargo-contract
    ```

4. Grab a local Substrate blockchain node with `pallet-contract` included. There are many options: [patract](https://github.com/patractlabs/patract) is the one we choose. Alternatively, you can get [canvas](https://github.com/paritytech/canvas-node) by Parity. `Rust` is known for compiling slowly. It took me an hour to compile [patract](https://github.com/patractlabs/patract). 

    - To use [patract](https://github.com/patractlabs/patract), follow this [guide](https://github.com/patractlabs/patract#compile-and-run).  

    - To use [canvas](https://github.com/paritytech/canvas-node), follow this [guide](https://substrate.dev/substrate-contracts-workshop/#/0/setup?id=installing-the-canvas-node). 

    - If you choose to use a `Canvas-node`, please change the `redspot.config.ts` in the `network.development.types` section to

        ```json
        types: {
            "LookupSource": "AccountId",
            "Address": "AccountId"
        }
        ```

    - If you choose to use a `Patract-node`, you do not need to do anything to `redspot.config.ts`. 

    - Lastly, fire up the local blockchain 

        ```
        path-to-patract-repo/target/release/patract-prep --dev --tmp
        # OR with Canvas
        canvas --dev --tmp
        ```

        You can visit https://ipfs.io/ipns/dotapps.io and choose to connect to `ws://127.0.0.1:9944` to have a visual portal to interact with the blockchain. 

5. clone this repo and initialize it by

    ```bash
    git clone https://github.com/skyekiwi/skyepass-vault.git
    cd skyepass-vault
    yarn # or npm install
    ```

    

#### Run Tests

Simply type in `yarn test` to start testing. The process can take somewhere between 10 - 30 minutes. 



## Code Structure

```
├── LICENSE.txt        --> Apache 2 License
├── (artifacts)        --> to be generated by Redspot that contains the compiled contract
│   ├── skyepassvault.contract
│   └── skyepassvault.json
├── client        --> Client side code
│   ├── blockchain.ts - UNFINISHED blockchain adapter 
│   ├── db.ts - DB is used to interact with the local password database
│   ├── index.ts
│   ├── ipfs.ts - IPFS is used to itneract with IPFS
│   ├── local.json - is the database to store caches of blockchain data, empty by now
│   ├── metadata.ts - Metadata is doing the heavly lifting. 
        Encryption/Decryption; Generate Metadata and Interaction w/ DB and IPFS.
│   └── passwords.json - the password database file
├── contracts
│   ├── Cargo.lock 
│   ├── Cargo.toml
│   ├── lib.rs - source code for the smart contract
│   └── (target)
│       .......
├── (node_modules) - generated by npm or yarn
|       .......
├── package.json
├── redspot.config.ts - Reference: https://redspot.patract.io/en/documentation/#configuration
├── scripts
│   ├── deploy.ts - run by `yarn deploy`
├── tests
│   └── skyepassvault.test.ts - All unit tests
├── tsconfig.json
└── yarn.lock
```

There are 5 parts in `skyepassvault.test.ts` and the first part is a end to end walkthrough of the process. Test names and descriptions should be very self-explanatory.


